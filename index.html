<!DOCTYPE html>
<html lang="ar" dir="rtl">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>مطعم صمام - قائمة طعام نهائية ومستقرة</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;500;700;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --bg-color: #f5ba38;
            --surface-color: #ffffff;
            --primary-color: #d87525;
            --primary-color-dark: #b85e1a;
            --text-color-primary: #3d352e;
            --text-color-secondary: #7a6a5d;
            --accent-color: #28a745;
            --border-color: #e0d5c1;
            --shadow-color: rgba(0, 0, 0, 0.08);
            --font-family: 'Tajawal', sans-serif;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body {
            font-family: var(--font-family);
            background-color: var(--bg-color);
            color: var(--text-color-primary);
            line-height: 1.7;
            overflow-x: hidden;
        }
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }

        .currency-symbol {
            display: inline-block;
            width: 0.9em;
            height: 0.9em;
            vertical-align: -0.1em;
            margin: 0 2px;
            content: url('https://upload.wikimedia.org/wikipedia/commons/thumb/9/98/Saudi_Riyal_Symbol.svg/800px-Saudi_Riyal_Symbol.svg.png');
        }

        .navbar {
            background-color: rgba(255, 255, 255, 0.85);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            box-shadow: 0 2px 10px var(--shadow-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
        }
        .navbar-brand { font-size: 1.8em; font-weight: 800; color: var(--primary-color); text-decoration: none; }
        .cart-toggle-button {
            background: none; border: none; font-size: 1.6em; color: var(--primary-color);
            cursor: pointer; position: relative; padding: 8px;
        }
        .cart-toggle-button .cart-count-badge {
            position: absolute; top: 0px; right: 0px; background-color: var(--primary-color);
            color: white; font-size: 0.6em; padding: 3px 7px;
            border-radius: 50%; font-weight: 700; border: 2px solid white;
        }

        .page-header { text-align: center; margin: 40px 0; }
        .page-header img { max-width: 180px; margin-bottom: 15px; }
        .page-title { font-size: 2.8em; font-weight: 800; color:#d21d40; }

        .search-controls {
            display: flex; justify-content: space-between; align-items: center;
            gap: 15px; margin-bottom: 20px; flex-wrap: wrap;
        }
        .search-container { position: relative; flex-grow: 1; }
        #search-input {
            width: 100%; padding: 12px 20px 12px 45px; border: 1px solid var(--border-color);
            background: var(--surface-color); border-radius: 25px; font-family: var(--font-family);
            font-size: 1em; outline: none; box-shadow: 0 2px 8px var(--shadow-color);
            transition: border-color 0.3s, box-shadow 0.3s;
        }
        #search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(216, 117, 37, 0.2), 0 2px 8px var(--shadow-color);
        }
        .search-icon { position: absolute; left: 18px; top: 50%; transform: translateY(-50%); color: #aaa; }
        
        .view-toggle-btn {
            background-color: var(--surface-color); color: var(--text-color-secondary);
            border: 1px solid var(--border-color); padding: 10px 14px; border-radius: 25px;
            cursor: pointer; font-size: 1.2em; transition: all 0.3s ease;
            box-shadow: 0 2px 8px var(--shadow-color); flex-shrink: 0;
        }
        .view-toggle-btn:hover { border-color: var(--primary-color); color: var(--primary-color); }
        .view-toggle-btn.active-compact-view { background-color: var(--primary-color); color: white; border-color: var(--primary-color); }

        .filters-container-wrapper { overflow-x: auto; padding-bottom: 10px; margin-bottom: 30px; }
        .filters-container-wrapper::-webkit-scrollbar { height: 6px; }
        .filters-container-wrapper::-webkit-scrollbar-thumb { background: var(--primary-color); border-radius: 10px; }
        .filters-container-wrapper::-webkit-scrollbar-track { background: #f0e6d8; }
        .filters-container { display: flex; flex-wrap: nowrap; gap: 12px; padding: 5px 0; }
        .filter-btn {
            background-color: rgba(255, 255, 255, 0.7); color: var(--text-color-secondary);
            border: 1px solid var(--border-color); padding: 10px 22px; border-radius: 22px;
            cursor: pointer; font-size: 1em; font-family: var(--font-family); font-weight: 500;
            transition: all 0.3s ease; white-space: nowrap; flex-shrink: 0;
        }
        .filter-btn:hover { background-color: var(--primary-color); color: white; border-color: var(--primary-color); transform: translateY(-2px); }
        .filter-btn.active {
            background-color: var(--primary-color); color: white; border-color: var(--primary-color-dark);
            font-weight: 700; box-shadow: 0 2px 5px rgba(216, 117, 37, 0.3);
        }

        .category-section { margin-bottom: 50px; }
        .category-title {
            font-size: 2em; font-weight: 700; color: var(--text-color-primary); margin-bottom: 25px;
            text-align: right; padding-bottom: 10px; border-bottom: 3px solid var(--primary-color); display: inline-block;
        }
        .products-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 25px; }
        .product-card {
            background-color: var(--surface-color); border: 1px solid var(--border-color);
            border-radius: 12px; box-shadow: 0 4px 15px var(--shadow-color);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            display: flex; flex-direction: column; overflow: hidden;
        }
        .product-card:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0,0,0,0.12); }
        .product-card img { width: 100%; height: 200px; object-fit: cover; transition: transform 0.3s ease, height 0.3s ease; }
        .product-card:hover img { transform: scale(1.05); }
        .product-info { padding: 15px; display: flex; flex-direction: column; flex-grow: 1; text-align: right; }
        .product-card h3 { margin: 0 0 8px 0; font-size: 1.25em; font-weight: 700; color: var(--text-color-primary); flex-grow: 1; }
        .product-description { font-size: 0.9em; color: var(--text-color-secondary); margin-bottom: 15px; min-height: 45px; }
        .price-and-action { display: flex; justify-content: space-between; align-items: center; margin-top: auto; }
        .product-card .price { font-size: 1.3em; font-weight: 800; color: #1e191a; }
        .product-card .customize-btn, .product-card .direct-add-btn {
            background-color: var(--primary-color); color: white; border: none; padding: 10px 18px;
            font-size: 0.95em; font-family: var(--font-family); font-weight: 500; border-radius: 8px;
            cursor: pointer; transition: background-color 0.3s, transform 0.2s;
            display: flex; align-items: center; gap: 8px;
        }
        .product-card .customize-btn:hover, .product-card .direct-add-btn:hover { background-color: var(--primary-color-dark); transform: scale(1.05); }

        body.compact-view .products-grid { grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; }
        body.compact-view .product-card img { height: 120px; }
        body.compact-view .product-card h3 { font-size: 1.1em; }
        body.compact-view .product-description { min-height: 20px; font-size: 0.8em; margin-bottom: 10px; }
        body.compact-view .price-and-action { flex-direction: column; align-items: stretch; gap: 10px; }
        body.compact-view .product-card .price { text-align: center; }

        .site-footer {
            background-color: #3d352e; color: #f5eadd; padding: 50px 0 20px 0;
            margin-top: 60px; border-top: 5px solid var(--primary-color);
        }
        .footer-content { display: flex; flex-wrap: wrap; justify-content: space-between; align-items: flex-start; gap: 40px; margin-bottom: 40px; }
        .footer-section { flex: 1; min-width: 280px; text-align: center; }
       
        .footer-restaurant-name { font-size: 2em; color: var(--primary-color); margin: 0 0 10px; font-weight: 800; }
        .footer-tagline { font-size: 1em; color: var(--border-color); margin-bottom: 10px; }
        .footer-section h4 { font-size: 1.3em; color: var(--primary-color); margin-bottom: 20px; }
        .footer-social-links a { color: #f5eadd; font-size: 1.6em; margin: 0 12px; transition: color 0.3s, transform 0.2s; display: inline-block; }
        .footer-social-links a:hover { color: var(--primary-color); transform: translateY(-3px); }
        .footer-bottom { border-top: 1px solid #5c4e43; padding-top: 20px; font-size: 0.9em; color: var(--border-color); text-align: center; }
        .calorie-note {
            font-size: 0.8em; color: #c5bbaF; max-width: 600px;
            margin: 0 auto 20px auto; line-height: 1.5;
        }

        @media (max-width: 768px) {
            .page-title { font-size: 2.2em; }
            .products-grid { grid-template-columns: 1fr; }
            .footer-content { flex-direction: column; align-items: center; }
            body.compact-view .products-grid { grid-template-columns: repeat(2, 1fr); }
        }

        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.6); z-index: 1001; justify-content: center; align-items: center; }
        .modal-overlay.active { display: flex; }
        .modal-content { background-color: var(--surface-color); padding: 30px; border-radius: 12px; box-shadow: 0 5px 20px rgba(0,0,0,0.2); width: 90%; max-width: 550px; max-height: 90vh; overflow-y: auto; position: relative; animation: fadeInModal 0.3s ease-out; }
        @keyframes fadeInModal { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
        .modal-close-btn { position: absolute; top: 15px; left: 15px; background: none; border: none; font-size: 2.5em; color: #aaa; cursor: pointer; line-height: 1; }
        .modal-product-image { width: 100%; height: 220px; object-fit: cover; border-radius: 8px; margin-bottom: 20px; }
        .modal-product-title { font-size: 1.8em; color: var(--primary-color); margin-bottom: 10px; text-align: center; font-weight: 700; }
        .modal-product-base-price, .modal-current-item-price { text-align: center; margin-bottom: 15px; }
        .modal-product-base-price { font-size: 1.2em; color: var(--text-color-secondary); }
        .modal-current-item-price { font-size: 1.3em; color: var(--primary-color); font-weight: bold; margin-top: 5px; }
        .modal-customizations .option-group { margin-bottom: 20px; border-top: 1px solid var(--border-color); padding-top: 15px; }
        .modal-customizations .option-group legend { font-weight: 700; margin-bottom: 10px; color: var(--text-color-primary); font-size: 1.1em; }
        .modal-customizations .option-item { display: block; margin-bottom: 8px; font-size: 1em; }
        .modal-customizations .option-item label { margin-right: 8px; cursor: pointer; }
        .modal-customizations .option-item input { margin-left: 10px; vertical-align: middle; }
        .modal-quantity-controls { display: flex; justify-content: center; align-items: center; margin: 25px 0; }
        .modal-quantity-controls input[type="number"] { width: 70px; padding: 10px; text-align: center; border: 1px solid var(--border-color); border-radius: 8px; font-size: 1.1em; margin: 0 10px; }
        .modal-add-to-cart-btn { background-color: var(--primary-color); color: white; border: none; padding: 14px 25px; text-align: center; display: block; width: 100%; font-size: 1.2em; font-family: var(--font-family); border-radius: 8px; cursor: pointer; transition: background-color 0.3s; }
        .modal-add-to-cart-btn:hover { background-color: var(--primary-color-dark); }
        .cart-sidebar { position: fixed; top: 0; right: -100%; width: 100%; max-width: 420px; height: 100%; background-color: #fffefb; box-shadow: -2px 0 15px rgba(0,0,0,0.1); transition: right 0.4s cubic-bezier(0.25, 0.46, 0.45, 0.94); z-index: 1002; display: flex; flex-direction: column; }
        .cart-sidebar.open { right: 0; }
        .cart-sidebar-header { padding: 20px; border-bottom: 1px solid var(--border-color); position: relative; }
        .cart-sidebar-header h2 { font-size: 1.6em; color: var(--primary-color); font-weight: 700; text-align: center; }
        .close-cart-btn-sidebar { position: absolute; top: 50%; transform: translateY(-50%); left: 15px; background: none; border: none; font-size: 2.5em; cursor: pointer; color: var(--text-color-secondary); line-height: 1; padding: 5px; }
        .cart-items-list-container { flex-grow: 1; overflow-y: auto; padding: 10px 20px; }
        .cart-sidebar-footer { padding: 20px; border-top: 1px solid var(--border-color); background: #f9f4ec; }
        .cart-items-list { list-style-type: none; padding: 0; }
        .cart-items-list li { padding: 15px 0; border-bottom: 1px dashed #ddd; display: flex; justify-content: space-between; align-items: flex-start; }
        .cart-item-details { flex-grow: 1; margin-right: 15px; }
        .cart-item-details .item-name { font-weight: 700; font-size: 1.1em; }
        .cart-item-details .item-customizations { font-size: 0.85em; color: var(--text-color-secondary); margin-top: 5px; }
        .cart-item-actions { text-align: left; }
        .item-total-price { font-weight: bold; }
        .remove-item-btn { background-color: #e74c3c !important; color: white; border: none; padding: 5px 10px !important; font-size: 0.8em !important; border-radius: 50%; cursor: pointer; margin-top: 5px; }
        .delivery-options, .payment-options { margin-bottom: 15px; text-align: center; }
        .payment-options-title { display: block; margin-bottom: 10px; font-weight: 700; color: var(--text-color-primary); }
        .cart-sidebar-footer textarea { width: 100%; padding: 10px; margin-bottom: 15px; border: 1px solid var(--border-color); border-radius: 8px; min-height: 70px; font-family: var(--font-family); font-size: 1em; }
        .summary-line { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 1em; }
        .summary-line.total { font-weight: 700; font-size: 1.3em; color: var(--primary-color); margin-top: 10px; }
        .cart-actions { display: flex; flex-direction: column; gap: 10px; margin-top: 15px; }
        .checkout-btn-whatsapp { width: 100%; background-color: #25D366; color: white; border: none; padding: 14px 20px; font-size: 1.1em; font-weight: 700; border-radius: 8px; transition: background-color 0.3s; }
        .checkout-btn-whatsapp:hover { background-color: #1ebe58; }
        .clear-cart-btn { width: 100%; background-color: #95a5a6; color: white; font-size: 0.9em; padding: 10px 15px; border-radius: 8px; }
        #empty-cart-message { text-align: center; color: var(--text-color-secondary); padding: 20px; }
        .page-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 1001; opacity: 0; transition: opacity 0.3s ease; }
        .page-overlay.active { display: block; opacity: 1; }
        .notification-toast { position: fixed; bottom: -100px; left: 50%; transform: translateX(-50%); background-color: var(--primary-color); color: white; padding: 15px 25px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2); z-index: 1003; transition: bottom 0.5s ease; font-size: 1em; }
        .notification-toast.show { bottom: 30px; }
    </style>
</head>
<body>

    <div class="modal-overlay" id="customization-modal-overlay">
        <div class="modal-content">
            <button class="modal-close-btn" id="modal-close-btn">&times;</button>
            <img src="" alt="Product Image" class="modal-product-image" id="modal-product-image">
            <h2 class="modal-product-title" id="modal-product-title"></h2>
            <p class="modal-product-base-price" id="modal-product-base-price"></p>
            <p class="modal-current-item-price" id="modal-current-item-price"></p>
            <div class="modal-customizations" id="modal-customizations-container"></div>
            <div class="modal-quantity-controls">
                <input type="number" id="modal-quantity" value="1" min="1" aria-label="الكمية">
            </div>
            <button class="modal-add-to-cart-btn" id="modal-add-to-cart-btn">
                أضف للطلبات <i class="fas fa-cart-plus"></i>
            </button>
        </div>
    </div>

    <div class="page-overlay" id="page-overlay"></div>

    <nav class="navbar">
        <a href="#" class="navbar-brand">صمّـام</a>
        <button class="cart-toggle-button" id="cart-toggle-btn" aria-label="فتح سلة التسوق">
            <i class="fas fa-shopping-basket"></i>
            <span class="cart-count-badge" id="cart-count-badge">0</span>
        </button>
    </nav>

    <div class="container">
        <header class="page-header">
            <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh26Dc_LaD23fCjeFUJzjMse-qbylj24NuuQ6Usnao0tjPO98roT6edRsNeb-on5lRa9fVhftKlXnsRMif1omFOXqPXv3FKDuAmOGASD1Zs8D0oM4iQlWDrxb1jl0C9ydi2v_o_fC5s6UB6eifNzOCOSRh4kTs7jWgdJ60ymDHIQqO_R8vfBeUUUH2T4Myz/s317/smmam2%20(1).png" alt="شعار مطعم صمام">
            <h1 class="page-title">قائمة الطعام</h1>
        </header>

        <div class="search-controls">
            <div class="search-container">
                <i class="fas fa-search search-icon"></i>
                <input type="text" id="search-input" placeholder="ابحث عن وجبتك المفضلة...">
            </div>
            <button id="toggle-view-btn" class="view-toggle-btn" title="تغيير طريقة العرض">
                <i class="fas fa-th-large"></i>
            </button>
        </div>
        
        <div class="filters-container-wrapper">
            <div class="filters-container" id="filters-container"></div>
        </div>

        <div id="menu-sections"></div>
    </div>
    
    <aside class="cart-sidebar" id="cart-sidebar">
        <div class="cart-sidebar-header">
            <h2>طلباتك</h2>
            <button class="close-cart-btn-sidebar" id="close-cart-btn-sidebar" aria-label="إغلاق السلة">&times;</button>
        </div>
        <div class="cart-items-list-container">
            <ul id="cart-items-list" class="cart-items-list"></ul>
        </div>
        <div class="cart-sidebar-footer">
            <div class="delivery-options">
                <label><input type="radio" name="deliveryType" value="pickup" checked> استلام من المطعم</label>
                <label><input type="radio" name="deliveryType" value="delivery"> توصيل (داخل الحي)</label>
            </div>
            <div class="payment-options">
                <span class="payment-options-title">اختر طريقة الدفع:</span>
                <label><input type="radio" name="paymentMethod" value="cash" checked> كاش</label>
                <label><input type="radio" name="paymentMethod" value="network"> شبكة (جهاز مدى)</label>
            </div>
            <textarea id="general-order-notes" placeholder="ملاحظات إضافية على الطلب"></textarea>
            <div class="summary-line">
                <span>المجموع الفرعي (شامل الضريبة):</span>
                <span><span id="cart-subtotal-amount">0</span><i class="currency-symbol"></i></span>
            </div>
            <div class="summary-line" id="delivery-fee-line" style="display: none;">
                <span>رسوم التوصيل:</span>
                <span><span id="delivery-fee-amount">0</span><i class="currency-symbol"></i></span>
            </div>
            <div class="summary-line total">
                <span>الإجمالي الكلي:</span>
                <span><span id="cart-grand-total-amount">0</span><i class="currency-symbol"></i></span>
            </div>
            <div class="cart-actions">
                <button class="checkout-btn-whatsapp" id="checkout-btn">
                    <i class="fab fa-whatsapp"></i> إرسال الطلب عبر واتساب
                </button>
                <button class="clear-cart-btn" id="clear-cart-btn">
                    إفراغ السلة <i class="fas fa-trash-alt"></i>
                </button>
            </div>
        </div>
    </aside>

    <div class="notification-toast" id="notification-toast">
        <i class="fas fa-check-circle"></i> <span id="notification-message"></span>
    </div>

    <footer class="site-footer">
        <div class="footer-content container">
            <div class="footer-section">
                <img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh26Dc_LaD23fCjeFUJzjMse-qbylj24NuuQ6Usnao0tjPO98roT6edRsNeb-on5lRa9fVhftKlXnsRMif1omFOXqPXv3FKDuAmOGASD1Zs8D0oM4iQlWDrxb1jl0C9ydi2v_o_fC5s6UB6eifNzOCOSRh4kTs7jWgdJ60ymDHIQqO_R8vfBeUUUH2T4Myz/s317/smmam2%20(1).png" alt="شعار المطعم" class="footer-logo-img">
       
                <p class="footer-tagline">أستعد لمغامرة جديدة بطعم ونكهة مناسبة لأصحاب الذائقة المميزة.</p>
                <p class="footer-tagline">جدة - حي السالم</p>
            </div>
            <div class="footer-section">
                <h4>كيف توصلنا</h4>
                <div class="footer-social-links">
                    <a href="https://maps.app.goo.gl/QN8Xc8NJbbA6soot8?g_st=com.google.maps.preview.copy" aria-label="موقعنا على الخريطة"><i class="fas fa-map-marker-alt"></i></a>
                    <a href="https://www.tiktok.com/@samamrestaurant?_t=ZS-8wcrCLgiCiO&_r=1" aria-label="تيك توك"><i class="fab fa-tiktok"></i></a>
                    <a href="https://www.instagram.com/samamrestaurant?igsh=M2oxOGFqcW9sZjMw&utm_source=qr" aria-label="إنستغرام"><i class="fab fa-instagram"></i></a>
                    <a href="https://www.facebook.com/share/165JNgcJyP/" aria-label="فيسبوك"><i class="fab fa-facebook-f"></i></a>
                    <a href="https://api.whatsapp.com/send/?phone=966539490701" aria-label="واتساب"><i class="fab fa-whatsapp"></i></a>
                </div>
            </div>
            <div class="footer-section">
                <h4>متواجدون على تطبيقات التوصيل</h4>
                <p class="footer-tagline">هنقرستيشن - جاهز - مرسول - كيتا - تويو - نون فود</p>
            </div>
        </div>
        <div class="footer-bottom">
            <p class="calorie-note">يحتاج البالغون تقريباً إلى 2000 سعرة حرارية في المتوسط يوميا، وطبعاً قد تختلف الاحتياجات الفردية من السعرات الحرارية من شخص لآخر.</p>
            <p>© <span id="current-year"></span> جميع الحقوق محفوظة لفريق حاجب سوفت.</p>
        </div>
    </footer>
    
    <script>
        const deliveryFee = 5;
        const CART_STORAGE_KEY = 'restaurantAppCart_vFinalCompleteWithFooterFixed';
        const COMPACT_VIEW_STORAGE_KEY = 'restaurantApp_compactView_v2';

        const productsData = [
            { "id": "IcrUgH", "name": "نصف مظبي دجاج", "category": "دجاج", "description": "2094cal", "basePrice": 20, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi8as8Lf83UNvRjG1SJrtHOqgvWpRV5KQO81XNw3dXkvLWw-urXHDF5CBeoZxoGUsTJxjhIF-REHZRZQ1PY5esbHQEeWIqR0PopWYPnI7eNMBfY_aogHG4M00UVQx7CsDGs-SSLVszI4b-N5D_DBbIibCPcfchy0a0D3OU3vGTd8-SBrb16EDRoHOBNhzB1/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.29%20PM%20(1).jpeg" },
            { "id": "Gan3oT", "name": "حبة مظبي دجاج", "category": "دجاج", "description": "3398cal", "basePrice": 40, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi8as8Lf83UNvRjG1SJrtHOqgvWpRV5KQO81XNw3dXkvLWw-urXHDF5CBeoZxoGUsTJxjhIF-REHZRZQ1PY5esbHQEeWIqR0PopWYPnI7eNMBfY_aogHG4M00UVQx7CsDGs-SSLVszI4b-N5D_DBbIibCPcfchy0a0D3OU3vGTd8-SBrb16EDRoHOBNhzB1/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.29%20PM%20(1).jpeg" },
            { "id": "cORcsR", "name": "حبة مضغوط دجاج", "category": "دجاج", "description": "950cal", "basePrice": 43, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiX8ouSYqZ5AhIY7zc5oOGeOnUXjbMX-kxpMWx3Mb3brh8fj3QiHN6rRRg_h2jEmDJ4TigZ7TLG8SqW2ZHTGcqTkCTjciMqVGvwn4U8i9FjDSEOB9Q4EnaxsGSga-2LcSVx5W4qePQa-7Ri17P1tl2yQCv8RP8XcTcyzqhhOB5Il7owwyB1IyBYsJ-sT-vZ/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.30%20PM%20(1).jpeg", "customizations": [{ "groupName": "اختر نوع الرز", "type": "radio", "name": "cust_cORcsR___", "required": true, "options": [{ "text": "رز مزه حبه طويل", "value": "rzmza", "price": 0 }, { "text": "ابو بنت", "value": "rz1c", "price": 1 }] }] },
            { "id": "bo8E3D", "name": "نصف مضغوط دجاج", "category": "دجاج", "description": "465cal", "basePrice": 21.5, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiX8ouSYqZ5AhIY7zc5oOGeOnUXjbMX-kxpMWx3Mb3brh8fj3QiHN6rRRg_h2jEmDJ4TigZ7TLG8SqW2ZHTGcqTkCTjciMqVGvwn4U8i9FjDSEOB9Q4EnaxsGSga-2LcSVx5W4qePQa-7Ri17P1tl2yQCv8RP8XcTcyzqhhOB5Il7owwyB1IyBYsJ-sT-vZ/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.30%20PM%20(1).jpeg", "customizations": [{ "groupName": "اختر نوع الرز", "type": "radio", "name": "cust_bo8E3D___", "required": true, "options": [{ "text": "رز مزه حبه طويله", "value": "mza55", "price": 0 }, { "text": "رز ابو بنت", "value": "bnh5", "price": 0.5 }] }] },
            { "id": "ij4aSL", "name": "نفر مضغوط حاشي", "category": "لحم", "description": "1400cal", "basePrice": 60, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEirlgju1hAnA_91C7Gw1zcsr5Tp9EygyOg1Cm247bk-t0T9TloTspQqh0iRfwPvkyley3aPKDbXdxQCHR5QR42nT1U3v7JIRCcXGh0RXUSvd-F-jKJcAFSJKyjKRVAmnGnyA267FTGMSLCBk39RE7SMy60NWUB4NtRHnE8_NUBkzXL6dS5N644rXe16kFjz/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.29%20PM.jpeg", "customizations": [{ "groupName": "اختر نوع الرز", "type": "radio", "name": "cust_ij4aSL___", "required": true, "options": [{ "text": "رز مزه حبه طويله", "value": "mm55", "price": 0 }, { "text": "رز ابو بنت", "value": "nm55", "price": 0 }] }] },
            { "id": "QFQv2n", "name": "مضغوط لحم حري", "category": "لحم", "description": "1400cal", "basePrice": 75, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgJ6AMPuOsH5juLH7ExWBmrGGaYGJb0HM_ZWwptOcYUCb5iGimVxltv4AcUsjHZmm_-zj-6kEi7csXCXEnD6lCsDf-MewcyJ89RRtrltxuujLAuZ34LHZm21X1AiV-yVVQV_gCETRI_6zB1LiYuagv8dOZ8QsgEa3sXhBU4m5foCuGx4rlPmc-arR6lS9kD/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.29%20PM%20(2).jpeg", "customizations": [{ "groupName": "اختر نوع الرز", "type": "radio", "name": "cust_QFQv2n___", "required": true, "options": [{ "text": "رز مزه حبه طويله", "value": "gbjm1", "price": 0 }, { "text": "رز ابو بنت", "value": "mnimj455", "price": 0 }] }] },
            { "id": "vMMrip", "name": "حبة دجاج مسلوق", "category": "دجاج", "description": "3398cal", "basePrice": 44, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgMKwmoVY874T-mz3UX9VPeQE9pvG-GK0RJqU_4oxdPGfu3F6wmJQ4arOD-taSQ8-EEHUAB-sOKOns0iffhwmUDWmMYiwJbBG-FZnMHHwmZGOciKGzBfHVeVGxTcThbdc5ZZQ-kNSHd_3vphnK0HZSdZDyugTDUD2nwDzJmRsf4QsGnF3wmxys3t0g505YN/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.30%20PM.jpeg" },
            { "id": "vMMrip1", "name": "نص دجاج مسلوق", "category": "دجاج", "description": "1980cal", "basePrice": 22, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgMKwmoVY874T-mz3UX9VPeQE9pvG-GK0RJqU_4oxdPGfu3F6wmJQ4arOD-taSQ8-EEHUAB-sOKOns0iffhwmUDWmMYiwJbBG-FZnMHHwmZGOciKGzBfHVeVGxTcThbdc5ZZQ-kNSHd_3vphnK0HZSdZDyugTDUD2nwDzJmRsf4QsGnF3wmxys3t0g505YN/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.30%20PM.jpeg" },
            { "id": "nfr-riz-abyad", "name": "نفر رز ابيض", "category": "رز", "description": "266cal", "basePrice": 6, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj17TaDmBhLVNo55FBMuOuhoQr08mXqnhgZhGEchQosHVq8kFky-9gqPK5j6D7pFxV1GdFUNFMeHx_FPRy0aSthOUcNV1drIWoVSTw0x0R20e_-qcIqpMl7-hc7chm5HtLOzqj9086LVfJtpX_ruAAn_xHurplzeVW-jQ5-NUdGScmAxXoW1bbfngk6HGL_/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.23%20PM.jpeg" },
            { "id": "2hpxbb", "name": "ايدام مسقع", "category": "طلبات جانبية", "description": "240cal", "basePrice": 5, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgZ_S2K0IJCAYluQPjoRJwBnNe4nM6NPpon2wcNWr7qILZvs3Yk6id8kr9PLUm0lkH_C_BelXuHVx1f7c9ksOWAOoUqyxfra2JvIyGDSmM7YPCD-VTGseNGrGFEbuCGm2D8PVvNOZ9pR3CDOQWnn5mvgPEaThvcMa1UtOlWxtfS6Saz4YlZan36F__iEU-W/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.28%20PM%20(1).jpeg" },
            { "id": "Z5Z7fn", "name": "ايدام مشكل خضار", "category": "طلبات جانبية", "description": "185cal", "basePrice": 5, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhBS2N5g0GTN7riCf-UsGVw2KkDFmtYg7XQgwTBwNXbtNP8Iq4D8n77JlOwo5H5MCjDAhGk6Ggc7ABwLVJvSS0J15iCeuc__tpPokXQHrXAqSqwuZAruFaOhE-7Dp4nwpm5FFVptq-TqvJYsBazMGTG_0N_XqwA43JBUP1YSwWonmO5nbHl-t08EF-cceTE/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.28%20PM.jpeg" },
            { "id": "G8IDza", "name": "سلطة خيار بالزبادي", "category": "طلبات جانبية", "description": "140cal", "basePrice": 3, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgO7Uj98eapso1pTGv88PzxIAAUDOAnv7FPEgpZgrzyJ8XKVv9kZPQeS-Y_3UvlG3zYovpuiRpFZ4jETUPu7kzo6ahYz3gmCAtw6NbhRri_uBzNm-N8vzV7yHKErxt3c8HVUsfPkxOENTE7oanqHWkbaACkt-mpfm2df_ZbO3wcBy4c9p-j8cnJmCpacPqI/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.27%20PM.jpeg" },
            { "id": "oaR6u8", "name": "طحينة", "category": "طلبات جانبية", "description": "173cal", "basePrice": 2, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhIx-5m3vtZkGZe3aRh2IXXUg7ME95zBUihn4mJDID6t847ghuyBxvP93zLp8BVV9qtS7D00Fed42khUCSwqmc7jfjTbWaQNbYiIYRuI50ZdQLj_SQH0AoABLmCyaykzyuaxhixOQC1WL8LOvt9iDB2KsSUU0ezmbdU70u1WzkQSxWCXw3wN4HGXqFgcHr0/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.24%20PM.jpeg" },
            { "id": "UcTRIu", "name": "سلطة حمراء", "category": "طلبات جانبية", "description": "73cal", "basePrice": 1, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgggSO7OMhGG1hfQZ4NoFOp5XDuCBELP9lpkSShfzwg0gv-7SUtuy6NHPPpu7yavFymtto0UQzGMZLxiydtX5d90NJP4gZdQ9Ofye-29bZxM8SOE97sx8idt_Ni9HFO7dMoxmVRycAuBAbM9C8fejv7lt0BabL8XFvViVPETGj6exqDghMiBRiLeTLksxF5/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.24%20PM%20(1).jpeg" },
            { "id": "fNOvF7", "name": "كنافة قشطة", "category": "طلبات جانبية", "description": "631cal", "basePrice": 8, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgLnTl2XL8ZMgM3QhWyfUN1Z18O_8qw_v28l7vE0px4DwSZT1d3NEjlFgjsm_ynfqZWR29eccAM4o__JfU-FxZLnzmOJvmyIh6m5OiSZG_eNOf9YRcejy-9keuK2JgoYnm1KVDsL4gHKR2YlxeQvhKhtlPCb55j6ZjT-j2breh68p-cK7RinSeiI2Aez6Bu/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.26%20PM%20(1).jpeg" },
            { "id": "DBwOHB", "name": "كنافة نوتيلا", "category": "طلبات جانبية", "description": "631cal", "basePrice": 10, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhaP5cVqxys12Rq3nopelZPc98zuYK4PED1URQ44yTjzoMREWqMNF-sDCHEpgv8A-bgnZX3z2bekPHBPda0PSV87vQkE4-Tz90ioVnLfdYFfHYdVHX4GKzGnqKN_syd4W5uLXI9SQOrGIQWORaNsBPYpjeubUhewQ_TR_JNNIYF1E3UxJ8AURFACWbwCh4I/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.27%20PM%20(1).jpeg" },
            { "id": "JW6aLV", "name": "ببسي 240 مل", "category": "المشروبات", "description": "145cal", "basePrice": 2, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhgmXxmP27TYumFap-Wsvp7waPU44uB07NXeOA2zVtlJJpdAhyphenhyphenHCDppuE_Fs2BoSL0tGktk1i9qOuZlUXsJWrOKstnYZ2saKBbeYcLKXeEjTIs5PKGqsRFerHauKBUFTpiji8BlIFYZwGBPpBeDanXMpPMIUUpqv2wKjAE8m2mk_7LzqVBkXgKkB2HugMlg/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.25%20PM%20(2).jpeg" },
            { "id": "JIAGbe", "name": "ببسي 320 مل", "category": "المشروبات", "description": "145cal", "basePrice": 2.5, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhgmXxmP27TYumFap-Wsvp7waPU44uB07NXeOA2zVtlJJpdAhyphenhyphenHCDppuE_Fs2BoSL0tGktk1i9qOuZlUXsJWrOKstnYZ2saKBbeYcLKXeEjTIs5PKGqsRFerHauKBUFTpiji8BlIFYZwGBPpBeDanXMpPMIUUpqv2wKjAE8m2mk_7LzqVBkXgKkB2HugMlg/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.25%20PM%20(2).jpeg" },
            { "id": "F1QQDr", "name": "حمضيات 220 مل", "category": "المشروبات", "description": "145cal", "basePrice": 2, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhfERxCzKmtXwQBbzw3c3-5e2kYhpt6s1qIw4gd3NZXzDCDaSgJ9D75fjNFhxP6zP4IWJxWMAhW2n0fY5ms3xCKXf7_HJb9xTLLsL2ouqWrQm5RApAetnJywVXx8J3GUZn-C8-PbJ61T2E_mj_N2rqHMFzZnDh4xoI-YrpO59mi4T6HrJalokSXHtQE9xMO/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.26%20PM.jpeg" },
            { "id": "qdyJl8", "name": "حمضيات 320 مل", "category": "المشروبات", "description": "145cal", "basePrice": 2.5, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhfERxCzKmtXwQBbzw3c3-5e2kYhpt6s1qIw4gd3NZXzDCDaSgJ9D75fjNFhxP6zP4IWJxWMAhW2n0fY5ms3xCKXf7_HJb9xTLLsL2ouqWrQm5RApAetnJywVXx8J3GUZn-C8-PbJ61T2E_mj_N2rqHMFzZnDh4xoI-YrpO59mi4T6HrJalokSXHtQE9xMO/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.26%20PM.jpeg" },
            { "id": "qdyJl18", "name": "ببسي دايت 240 مل", "category": "المشروبات", "description": "1cal", "basePrice": 2, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhgmXxmP27TYumFap-Wsvp7waPU44uB07NXeOA2zVtlJJpdAhyphenhyphenHCDppuE_Fs2BoSL0tGktk1i9qOuZlUXsJWrOKstnYZ2saKBbeYcLKXeEjTIs5PKGqsRFerHauKBUFTpiji8BlIFYZwGBPpBeDanXMpPMIUUpqv2wKjAE8m2mk_7LzqVBkXgKkB2HugMlg/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.25%20PM%20(2).jpeg" },
            { "id": "tVG8tJ", "name": "موية", "category": "المشروبات", "description": "0cal", "basePrice": 1, "image": "https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3nOaYvlBSmHjh-tPKLEI3qXBSbwYWsr9bOJGiGz1TE-9Eod1yqnbDHOp2JTYnuTLCASEXEZ1HTvIVKlll0Oa04_uMOUL4NVBDk3B8Y2iVkdwqj6XQF50YyfR1qcESlVSp8V0BggPCWrfcVfwXw7Px23awq89q69zxOamB-vlLiOJ5qDfJJfK2QbQP5HNE/s1080/WhatsApp%20Image%202025-08-10%20at%2010.43.25%20PM.jpeg" }
        ];

        document.addEventListener('DOMContentLoaded', () => {
            try {
                // --- DOM Elements (Corrected Definitions) ---
                const modalOverlay = document.getElementById('customization-modal-overlay');
                const modalCloseBtn = document.getElementById('modal-close-btn');
                const modalProductImage = document.getElementById('modal-product-image');
                const modalProductTitle = document.getElementById('modal-product-title');
                const modalProductBasePrice = document.getElementById('modal-product-base-price');
                const modalCurrentItemPrice = document.getElementById('modal-current-item-price');
                const modalCustomizationsContainer = document.getElementById('modal-customizations-container');
                const modalQuantityInput = document.getElementById('modal-quantity');
                const modalAddToCartBtn = document.getElementById('modal-add-to-cart-btn');
                const menuSectionsContainer = document.getElementById('menu-sections');
                const filtersContainer = document.getElementById('filters-container');
                const cartItemsListElement = document.getElementById('cart-items-list');
                const cartSubtotalAmountElement = document.getElementById('cart-subtotal-amount');
                const deliveryFeeLineElement = document.getElementById('delivery-fee-line');
                const deliveryFeeAmountElement = document.getElementById('delivery-fee-amount');
                const cartGrandTotalAmountElement = document.getElementById('cart-grand-total-amount');
                const checkoutBtn = document.getElementById('checkout-btn');
                const cartToggleButton = document.getElementById('cart-toggle-btn');
                const closeCartButtonSidebar = document.getElementById('close-cart-btn-sidebar');
                const cartSidebar = document.getElementById('cart-sidebar');
                const pageOverlay = document.getElementById('page-overlay');
                const cartCountBadge = document.getElementById('cart-count-badge');
                const clearCartBtn = document.getElementById('clear-cart-btn');
                const notificationToast = document.getElementById('notification-toast');
                const notificationMessage = document.getElementById('notification-message');
                const generalOrderNotesTextarea = document.getElementById('general-order-notes');
                const searchInput = document.getElementById('search-input');
                const toggleViewBtn = document.getElementById('toggle-view-btn');
                const deliveryTypeRadios = document.querySelectorAll('input[name="deliveryType"]');
                const paymentMethodRadios = document.querySelectorAll('input[name="paymentMethod"]');
                
                // --- State Variables ---
                let cart = [], currentDeliveryType = 'pickup', currentPaymentMethod = 'cash',
                    currentProductInModalObject = null, notificationTimeout, currentActiveFilter = 'all',
                    currentSearchTerm = '', isCompactView = false;
                const whatsappNumber = "966539490701";

                // --- Core Functions ---
                const saveCartToLocalStorage = () => localStorage.setItem(CART_STORAGE_KEY, JSON.stringify(cart));
                const loadCartFromLocalStorage = () => { cart = JSON.parse(localStorage.getItem(CART_STORAGE_KEY) || '[]'); };
                const saveViewPreference = () => localStorage.setItem(COMPACT_VIEW_STORAGE_KEY, isCompactView);
                
                function loadViewPreference() {
                    isCompactView = localStorage.getItem(COMPACT_VIEW_STORAGE_KEY) === 'true';
                    document.body.classList.toggle('compact-view', isCompactView);
                    toggleViewBtn.classList.toggle('active-compact-view', isCompactView);
                    toggleViewBtn.innerHTML = isCompactView ? '<i class="fas fa-th-list"></i>' : '<i class="fas fa-th-large"></i>';
                    toggleViewBtn.title = isCompactView ? "عرض عادي" : "عرض مضغوط";
                }

                function displayFilterButtons() {
                    filtersContainer.innerHTML = '';
                    const categories = ['all', ...new Set(productsData.map(p => p.category))];
                    categories.forEach(category => {
                        const button = document.createElement('button');
                        button.className = 'filter-btn';
                        button.dataset.category = category;
                        button.textContent = category === 'all' ? 'عرض الكل' : category;
                        if (category === currentActiveFilter) button.classList.add('active');
                        button.onclick = function() {
                            currentActiveFilter = this.dataset.category;
                            displayProducts();
                            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                            this.classList.add('active');
                        };
                        filtersContainer.appendChild(button);
                    });
                }

                function displayProducts() {
                    menuSectionsContainer.innerHTML = '';
                    const searchTermLower = currentSearchTerm.toLowerCase();
                    const filteredProducts = productsData.filter(p => 
                        (currentActiveFilter === 'all' || p.category === currentActiveFilter) &&
                        (searchTermLower === '' || p.name.toLowerCase().includes(searchTermLower) || (p.description && p.description.toLowerCase().includes(searchTermLower)))
                    );

                    if (filteredProducts.length === 0) {
                        menuSectionsContainer.innerHTML = `<p style="text-align:center; padding: 20px; color: var(--text-color-secondary);">لا توجد منتجات تطابق بحثك.</p>`;
                        return;
                    }

                    const productsByCategory = filteredProducts.reduce((acc, product) => {
                        (acc[product.category] = acc[product.category] || []).push(product);
                        return acc;
                    }, {});

                    const displayOrder = currentActiveFilter === 'all' ? [...new Set(productsData.map(p => p.category))] : [currentActiveFilter];

                    displayOrder.forEach(category => {
                        if (!productsByCategory[category]) return;
                        const categorySection = document.createElement('div');
                        categorySection.className = 'category-section';
                        categorySection.innerHTML = `<h2 class="category-title">${category}</h2>`;
                        const productsGrid = document.createElement('div');
                        productsGrid.className = 'products-grid';
                        productsByCategory[category].forEach(product => {
                            const productCard = document.createElement('div');
                            productCard.className = 'product-card';
                            const actionButtonHTML = (product.customizations && product.customizations.length > 0)
                                ? `<button class="customize-btn" onclick="openCustomizationModal('${product.id}')"><i class="fas fa-cog"></i> تخصيص</button>`
                                : `<button class="direct-add-btn" onclick="addDirectToCart('${product.id}')"><i class="fas fa-cart-plus"></i> إضافة</button>`;
                            productCard.innerHTML = `
                                <img src="${product.image}" alt="${product.name}" loading="lazy">
                                <div class="product-info">
                                    <h3>${product.name}</h3>
                                    <p class="product-description">${product.description || ''}</p>
                                    <div class="price-and-action">
                                        ${actionButtonHTML}
                                        <span class="price">${product.basePrice}<i class="currency-symbol"></i></span>
                                    </div>
                                </div>`;
                            productsGrid.appendChild(productCard);
                        });
                        categorySection.appendChild(productsGrid);
                        menuSectionsContainer.appendChild(categorySection);
                    });
                }

                window.addDirectToCart = function(productId) {
                    const product = productsData.find(p => p.id === productId);
                    if (!product) return;
                    const existingItem = cart.find(item => item.cartItemId === productId);
                    if (existingItem) {
                        existingItem.quantity++;
                    } else {
                        cart.push({ cartItemId: productId, id: productId, name: product.name, basePrice: product.basePrice, finalPricePerItem: product.basePrice, quantity: 1, customizations: [], image: product.image });
                    }
                    updateCartDisplay();
                    saveCartToLocalStorage();
                    showNotification(`"${product.name}" أضيف إلى طلباتك.`);
                };
                
                window.openCustomizationModal = function(productId) {
                    currentProductInModalObject = productsData.find(p => p.id === productId);
                    if (!currentProductInModalObject) return;
                    modalProductImage.src = currentProductInModalObject.image;
                    modalProductTitle.textContent = currentProductInModalObject.name;
                    modalProductBasePrice.innerHTML = `السعر الأساسي: ${currentProductInModalObject.basePrice}<i class="currency-symbol"></i>`;
                    modalQuantityInput.value = 1;
                    modalCustomizationsContainer.innerHTML = '';
                    if (currentProductInModalObject.customizations) {
                        currentProductInModalObject.customizations.forEach((group, groupIndex) => {
                            const fieldset = document.createElement('fieldset');
                            fieldset.className = 'option-group';
                            fieldset.innerHTML = `<legend>${group.groupName}${group.required ? ' (مطلوب)' : ''}</legend>`;
                            group.options.forEach((opt, optIndex) => {
                                const optionDiv = document.createElement('div');
                                optionDiv.className = 'option-item';
                                const inputId = `modal-opt-${productId}-${groupIndex}-${optIndex}`;
                                optionDiv.innerHTML = `
                                    <input type="${group.type}" id="${inputId}" name="modal-${productId}-${group.name}" value="${opt.value}" data-price="${opt.price}">
                                    <label for="${inputId}">${opt.text} ${opt.price > 0 ? `(+${opt.price}<i class="currency-symbol"></i>)` : ''}</label>`;
                                const input = optionDiv.querySelector('input');
                                if (group.type === 'radio' && group.required && optIndex === 0) input.checked = true;
                                input.onchange = updateModalPrice;
                                fieldset.appendChild(optionDiv);
                            });
                            modalCustomizationsContainer.appendChild(fieldset);
                        });
                    }
                    updateModalPrice();
                    modalOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
                
                function updateModalPrice() {
                    if (!currentProductInModalObject) return;
                    let currentPrice = currentProductInModalObject.basePrice;
                    modalCustomizationsContainer.querySelectorAll('input:checked').forEach(input => {
                        currentPrice += parseFloat(input.dataset.price);
                    });
                    modalCurrentItemPrice.innerHTML = `السعر الحالي: ${currentPrice.toFixed(2)}<i class="currency-symbol"></i>`;
                }
                
                const closeCustomizationModal = () => {
                    modalOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                };

                modalAddToCartBtn.onclick = function() {
                    if (!currentProductInModalObject) return;
                    const product = currentProductInModalObject;
                    if (product.customizations) {
                        for (const group of product.customizations) {
                            if (group.required && !modalCustomizationsContainer.querySelector(`input[name="modal-${product.id}-${group.name}"]:checked`)) {
                                return alert(`الرجاء اختيار خيار من "${group.groupName}".`);
                            }
                        }
                    }
                    let itemPrice = product.basePrice, selectedCustomizations = [], cartItemIdSuffix = '';
                    modalCustomizationsContainer.querySelectorAll('input:checked').forEach(input => {
                        itemPrice += parseFloat(input.dataset.price);
                        cartItemIdSuffix += `-${input.value}`;
                        selectedCustomizations.push({ text: input.labels[0].textContent.split(' (+')[0], price: parseFloat(input.dataset.price) });
                    });
                    const cartItemId = `${product.id}${cartItemIdSuffix}`;
                    const existingItem = cart.find(item => item.cartItemId === cartItemId);
                    const quantity = parseInt(modalQuantityInput.value);
                    if (existingItem) {
                        existingItem.quantity += quantity;
                    } else {
                        cart.push({ cartItemId, id: product.id, name: product.name, basePrice: product.basePrice, finalPricePerItem: itemPrice, quantity, customizations: selectedCustomizations, image: product.image });
                    }
                    updateCartDisplay();
                    saveCartToLocalStorage();
                    showNotification(`"${product.name}" أضيف إلى طلباتك.`);
                    closeCustomizationModal();
                };

                function showNotification(message) {
                    notificationMessage.textContent = message;
                    notificationToast.classList.add('show');
                    clearTimeout(notificationTimeout);
                    notificationTimeout = setTimeout(() => notificationToast.classList.remove('show'), 3000);
                }

                function updateCartDisplay() {
                    cartItemsListElement.innerHTML = '';
                    let subtotal = 0, totalItemsCount = 0;
                    if (cart.length === 0) {
                        cartItemsListElement.innerHTML = `<li id="empty-cart-message">سلة الطلبات فارغة.</li>`;
                        clearCartBtn.style.display = 'none';
                    } else {
                        clearCartBtn.style.display = 'block';
                        cart.forEach((item, index) => {
                            const listItem = document.createElement('li');
                            const customizationsHTML = item.customizations.map(c => `<div>- ${c.text}</div>`).join('');
                            listItem.innerHTML = `
                                <div class="cart-item-details">
                                    <span class="item-name">${item.name} (×${item.quantity})</span>
                                    ${customizationsHTML ? `<div class="item-customizations">${customizationsHTML}</div>` : ''}
                                </div>
                                <div class="cart-item-actions">
                                    <span class="item-total-price">${(item.finalPricePerItem * item.quantity).toFixed(2)}<i class="currency-symbol"></i></span>
                                    <button class="remove-item-btn" onclick="removeFromCart(${index})"><i class="fas fa-times"></i></button>
                                </div>`;
                            cartItemsListElement.appendChild(listItem);
                            subtotal += item.finalPricePerItem * item.quantity;
                            totalItemsCount += item.quantity;
                        });
                    }
                    cartSubtotalAmountElement.textContent = subtotal.toFixed(2);
                    const deliveryFeeValue = currentDeliveryType === 'delivery' && cart.length > 0 ? deliveryFee : 0;
                    deliveryFeeLineElement.style.display = deliveryFeeValue > 0 ? 'flex' : 'none';
                    deliveryFeeAmountElement.textContent = deliveryFeeValue.toFixed(2);
                    cartGrandTotalAmountElement.textContent = (subtotal + deliveryFeeValue).toFixed(2);
                    cartCountBadge.textContent = totalItemsCount;
                }

                window.removeFromCart = function(index) {
                    cart.splice(index, 1);
                    updateCartDisplay();
                    saveCartToLocalStorage();
                }
                
                const openCartSidebar = () => {
                    cartSidebar.classList.add('open');
                    pageOverlay.classList.add('active');
                    document.body.style.overflow = 'hidden';
                }
                const closeCartSidebar = () => {
                    cartSidebar.classList.remove('open');
                    pageOverlay.classList.remove('active');
                    document.body.style.overflow = '';
                }

                function emptyCartAfterCheckout() {
                    cart = [];
                    generalOrderNotesTextarea.value = '';
                    deliveryTypeRadios.forEach(radio => {
                        if (radio.value === 'pickup') radio.checked = true;
                    });
                    currentDeliveryType = 'pickup';
                    paymentMethodRadios.forEach(radio => {
                        if (radio.value === 'cash') radio.checked = true;
                    });
                    currentPaymentMethod = 'cash';

                    updateCartDisplay();
                    saveCartToLocalStorage();
                    showNotification("تم إرسال طلبك! سيتم الآن إفراغ السلة.");
                    closeCartSidebar();
                }

                checkoutBtn.onclick = function() {
                    if (cart.length === 0) { return alert("سلة الطلبات فارغة!"); }
                    let message = "طلب جديد من مطعم صمام:\n\n", total = 0;
                    cart.forEach(item => {
                        message += `*${item.name}* (الكمية: ${item.quantity})\n`;
                        if(item.customizations.length > 0){ item.customizations.forEach(c => { message += `  - ${c.text}\n`; }); }
                        const itemTotal = item.finalPricePerItem * item.quantity;
                        message += `  *السعر:* ${itemTotal.toFixed(2)} ر.س\n\n`;
                        total += itemTotal;
                    });
                    message += "--------------------\n";
                    message += `*المجموع:* ${total.toFixed(2)} ر.س\n`;
                    if (currentDeliveryType === 'delivery') {
                        total += deliveryFee;
                        message += `*رسوم التوصيل:* ${deliveryFee.toFixed(2)} ر.س\n`;
                    }
                    message += `*الإجمالي الكلي:* ${total.toFixed(2)} ر.س\n\n`;
                    message += `*نوع الطلب:* ${document.querySelector('input[name="deliveryType"]:checked').parentElement.textContent.trim()}\n`;
                    message += `*طريقة الدفع:* ${document.querySelector('input[name="paymentMethod"]:checked').parentElement.textContent.trim()}\n`;
                    if(generalOrderNotesTextarea.value.trim()) { message += `*ملاحظات:* ${generalOrderNotesTextarea.value.trim()}\n`; }
                    window.open(`https://wa.me/${whatsappNumber}?text=${encodeURIComponent(message)}`, '_blank');
                    
                    setTimeout(emptyCartAfterCheckout, 1000);
                };

                function setupUIListeners() {
                    cartToggleButton.onclick = openCartSidebar;
                    closeCartButtonSidebar.onclick = closeCartSidebar;
                    pageOverlay.onclick = closeCartSidebar;
                    modalCloseBtn.onclick = closeCustomizationModal;
                    modalOverlay.onclick = (e) => { if (e.target === modalOverlay) closeCustomizationModal(); };
                    searchInput.oninput = (e) => { currentSearchTerm = e.target.value; displayProducts(); };
                    deliveryTypeRadios.forEach(r => { r.onchange = (e) => { currentDeliveryType = e.target.value; updateCartDisplay(); }; });
                    paymentMethodRadios.forEach(r => { r.onchange = (e) => { currentPaymentMethod = e.target.value; }; });
                    clearCartBtn.onclick = () => { if (confirm("هل أنت متأكد من إفراغ السلة؟")) { cart = []; updateCartDisplay(); saveCartToLocalStorage(); } };
                    toggleViewBtn.onclick = function() {
                        isCompactView = !isCompactView;
                        saveViewPreference();
                        loadViewPreference();
                    };
                }

                // Initial Load
                loadCartFromLocalStorage();
                loadViewPreference();
                displayFilterButtons();
                displayProducts();
                updateCartDisplay();
                setupUIListeners();
                document.getElementById('current-year').textContent = new Date().getFullYear();

            } catch (error) {
                console.error("A critical error occurred during initialization:", error);
                const menuContainer = document.getElementById('menu-sections');
                if (menuContainer) {
                    menuContainer.innerHTML = `<p style="text-align:center; color: red; font-weight: bold; padding: 20px;">عفواً، حدث خطأ فني أثناء تحميل القائمة. يرجى محاولة تحديث الصفحة.</p>`;
                }
            }
        });
    </script>
</body>
</html>
